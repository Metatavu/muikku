/* User School Data Bridge */

CREATE TABLE User (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  firstName VARCHAR(255) NOT NULL,
  lastName VARCHAR(255) NOT NULL,
  role_id BIGINT NOT NULL
);

CREATE TABLE UserEmail (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  user_id BIGINT  NOT NULL,
  address VARCHAR(255) NOT NULL
);

CREATE TABLE UserImage (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  content_type VARCHAR(255) NOT NULL,
  content BLOB NOT NULL
);

CREATE TABLE UserProperty (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  key VARCHAR(255) NOT NULL,
  value VARCHAR(255) NOT NULL
);

/* Workspace School Data Bridge */

CREATE TABLE Workspace (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  subject VARCHAR(255),
  name VARCHAR(255) NOT NULL,
  type_id BIGINT NOT NULL
);

CREATE TABLE WorkspaceType (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  name VARCHAR(255) NOT NULL
);

CREATE TABLE WorkspaceUser (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  workspace_id BIGINT NOT NULL
);

/* Roles */

CREATE TABLE Role (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  type VARCHAR(255) NOT NULL
);

CREATE TABLE UserWorkspaceRole (
  id BIGINT NOT NULL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  role_id BIGINT NOT NULL,
  workspace_id BIGINT NOT NULL
);

ALTER TABLE User ADD CONSTRAINT FK_USER_ROLE_ID FOREIGN KEY (role_id)  REFERENCES Role (id) ON DELETE CASCADE;
ALTER TABLE UserEmail ADD CONSTRAINT FK_USEREMAIL_USER_ID FOREIGN KEY (user_id)  REFERENCES User (id) ON DELETE CASCADE;
ALTER TABLE UserImage ADD CONSTRAINT FK_USERIMAGE_USER_ID FOREIGN KEY (user_id)  REFERENCES User (id) ON DELETE CASCADE;
ALTER TABLE UserProperty ADD CONSTRAINT FK_USERPROPERTY_USER_ID FOREIGN KEY (user_id)  REFERENCES User (id) ON DELETE CASCADE;
ALTER TABLE Workspace ADD CONSTRAINT FK_WORKSPACE_TYPE_ID FOREIGN KEY (type_id)  REFERENCES WorkspaceType (id) ON DELETE CASCADE;
ALTER TABLE WorkspaceUser ADD CONSTRAINT FK_WORKSPACEUSER_USER_ID FOREIGN KEY (user_id)  REFERENCES User (id) ON DELETE CASCADE;
ALTER TABLE UserWorkspaceRole ADD CONSTRAINT FK_USERWORKSPACEROLE_USER_ID FOREIGN KEY (user_id)  REFERENCES User (id) ON DELETE CASCADE;
ALTER TABLE UserWorkspaceRole ADD CONSTRAINT FK_USERWORKSPACEROLE_ROLE_ID FOREIGN KEY (role_id)  REFERENCES Role (id) ON DELETE CASCADE;
ALTER TABLE UserWorkspaceRole ADD CONSTRAINT FK_USERWORKSPACEROLE_WORKSPACE_ID FOREIGN KEY (workspace_id)  REFERENCES Workspace (id) ON DELETE CASCADE;